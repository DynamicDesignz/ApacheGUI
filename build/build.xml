<?xml version="1.0"?>
<project name="ApacheConfParser" default="war" basedir=".">

	<property name="ant.build.javac.source" value="1.6"/>
	<property name="ant.build.javac.target" value="1.6"/>
	
	<loadproperties srcFile="build.properties"/> 
		
	<property name="resources.dir" value="../WebContent/resources"/>
	<property name="release.dir" value="release"/>
	<property name="dist.dir" value="dist"/>
	<property name="lib.dir" value="../WebContent/WEB-INF/lib"/>
	    
	<!-- clean -->
	<target name="clean">
	
		<delete quiet="true" includeemptydirs="true">
            <fileset dir="${release.dir}" includes="**/*"/>
            <fileset dir="${dist.dir}" includes="**/*"/>
         </delete>
		
	</target>
	
	<!-- build js -->
	<target name="buildjs">
	
		<exec dir="${resources.dir}" executable="util/buildscripts/build.sh">
		       <arg line="bin=node"/>
		       <arg line="profile=apachegui.profile.js"/>
		       <arg line="action=release"/>
		</exec>
		
	</target>
	
	
	<!-- remove less and uncompressed -->
	<target name="deleteunused">
	
	     <delete>
	        <fileset dir="${release.dir}" includes="**/*.less"/>
	     	<fileset dir="${release.dir}" includes="**/*.uncompressed.js"/>
	     	<fileset dir="${release.dir}" includes="**/*.js.map"/>
	     </delete>
	
	</target>	
	
	<!-- copy resources to release directory -->
	<target name="copyrelease">
		<copy todir="${release.dir}">
            <fileset dir="../WebContent">  
                <include name="HistoryFiles/**"/>
                <include name="search/**"/>
            </fileset>
        </copy>
		<copy todir="${release.dir}/resources">
    		<fileset dir="${resources.dir}">  
    			<include name="codemirror/**"/>
                <include name="flot/**"/>
                <include name="images/**"/>
                <include name="jquery/**"/>
                <include name="json/**"/>
                <include name="style/**"/>
    		</fileset>
		</copy>
	</target>
	
	<!-- build war -->
	
	<target name="war" description="Build the ApacheGUI war file" depends="clean,buildjs,deleteunused,copyrelease">
        <war destfile="${dist.dir}/ApacheGUI.war" webxml="../WebContent/WEB-INF/web.xml">
          <fileset dir="${release.dir}"/>
          <lib dir="${lib.dir}"></lib>
          <webinf dir="../WebContent/WEB-INF">
               <include name="jsp/**"/>
          	   <include name="spring-servlet.xml"/>
          </webinf>	
          <classes dir="classes"/>
        </war>
    </target>   
	
	
	
	<!-- move war to webapps -->
	<target name="deploy">
		<move file="${dist.dir}/ApacheGUI.war" todir="${apachegui_home}/tomcat/webapps"/>
	</target>
	
	
</project>	
